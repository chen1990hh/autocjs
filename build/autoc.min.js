/* 
 AutocJS - Simple & Fast to create a table of contents menu for your article. 
 Copyright (c) 2016 yaohaixiao, all right reserved. 
 homepage: https://github.com/yaohaixiao/AutocJS/#readme 
 version: 0.2.0 
 author: yaohaixiao  
 license: MIT 
 */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define("autocjs",["jquery"],b(a,$)):"function"==typeof define&&define.cmd?define("autocjs",function(c,d,e){e.exports=b(a,c("jquery"))}):"object"==typeof exports?module.exports=b(a,require("jquery")):b(a,jQuery)}("undefined"!=typeof window?window:this,function(a,b){"use strict";function c(a){return a.replace(new RegExp(j,"img"),"")}function d(a){return a.replace(/[\r\t\n]/g," ").replace(/[&<>"'\/`]/g,function(a){return i[a]})}function e(a){return a.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/").replace(/&#x60;/g,"`")}function f(a){return e(d(c(a)))}function g(a){var b,c=a.data,d=a.html,e=a.startTag||"{",g=a.endTag||"}";d+="";for(b in c)d=d.replace(new RegExp(e+b+g,"img"),f(c[b]));return f(d)}function h(a){return k+=1,a?a+"-"+k:k}var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;","`":"&#x60;"},j="<script[^>]*>([\\S\\s]*?)</script\\s*>",k=-1,l="toc-show",m="toc-hide",n="autocjs-anchor",o="toc-icon",p='<div id="toc" class="toc toc-hide" aria-hidden="true"></div>',q='<h3 class="toc-title" id="toc-title" aria-hidden="true">{title}</h3>',r='<div class="toc-bar" aria-hidden="true"></div>',s='<h2 class="toc-switch" class="toc-switch" title="Toggle Menu" aria-hidden="true">&#926;</h2>',t='<a class="toc-top" id="toc-top" href="#top" aria-hidden="true">TOP</a>',u='<nav id="toc-bd" class="toc-bd" aria-hidden="true"></nav>',v='<ol id="toc-list" class="toc-list" aria-hidden="true"></ol>',w='<ol class="toc-sub-list" aria-hidden="true"></ol>',x='<li class="toc-item" aria-hidden="true"></li>',y='<a aria-hidden="true"></a>',z='<a aria-hidden="true" class="toc-anchor-link"></a>',A='<em class="toc-chapter" aria-hidden="true"></em>',B='<div id="toc-overlay" class="toc-overlay toc-hide" aria-hidden="true"></div>',C="h1,h2,h3,h4,h5,h6",D="anchor",E=function(a){return this.attributes={},this.elements={article:null,wrap:null,title:null,bar:null,switch:null,top:null,body:null,list:null,overlay:null},this.data={anchors:[],chapters:[]},this.set(E.defaults),b.isPlainObject(a)&&this.init(a),this};return E.defaults={article:"#article",title:"Table of Contents",selector:C,prefix:D,WRAP:p,TITLE:q,BAR:r,SWITCH:s,TOP:t,BODY:u,LIST:v,SUB_LIST:v,ITEM:x,LINK:y,ANCHOR_LINK:z,CHAPTER:A,OVERLAY:B},E.prototype={version:"0.2.0",constructor:E,set:function(a){return b.isPlainObject(a)&&b.extend(this.attributes,a),this},get:function(a){return this.attributes[a]},anchors:function(a){return b.isArray(a)?(this.data.anchors=a,this):this.data.anchors},chapters:function(a){return b.isPlainObject(a)?(this.data.chapters=a,this):this.data.chapters},getArticleAnchors:function(){return this.elements.article.find(this.get("selector"))},getArticleChapters:function(){var a=this,c=[],d=1,e=0,f=this.get("prefix");return b(this.getArticleAnchors()).each(function(g,i){var j=h(f),k=b(i),l=k.html(),m=parseInt(k[0].tagName.toUpperCase().replace(/[H]/gi,""),10),n=-1;m>d?(e+=1,n=1===e?-1:g-1):m===d||m<d&&m>e?1===m?(e=1,n=-1):n=c[g-1].pid:m<=e&&(1===m?e=1:e-=d-m,n=1===e?-1:a.getPidByDiffer(c,d-m,g)),d=m,c.push({id:g,level:e,text:l,value:j,tag:i.tagName,pid:n})}),c},getPidByDiffer:function(a,b,c){var d=-1;switch(b){case 1:d=a[a[c-1].pid].pid;break;case 2:d=a[a[a[c-1].pid].pid].pid;break;case 3:d=a[a[a[a[c-1].pid].pid].pid].pid;break;case 4:d=a[a[a[a[a[c-1].pid].pid].pid].pid].pid;break;case 5:d=a[a[a[a[a[a[c-1].pid].pid].pid].pid].pid].pid;break;default:d=a[a[c-1].pid].pid}return d},init:function(a){return b.isPlainObject(a)&&this.set(a),this._init().render().attachEvents(),this},_init:function(){var a=this,c=this.elements;return c.article=b(this.get("article")),c.wrap=b(this.get("WRAP")),c.title=b(g({data:{title:a.get("title")},html:a.get("TITLE")})),c.bar=b(this.get("BAR")),c.switch=b(this.get("SWITCH")),c.top=b(this.get("TOP")),c.body=b(this.get("BODY")),c.list=b(this.get("LIST")),c.overlay=b(this.get("OVERLAY")),this.data.anchors=this.getArticleAnchors(),this.data.chapters=this.getArticleChapters(),this},render:function(){return this.renderLinks().renderElements().renderChapters(),this.elements.wrap.removeClass(m),this.updateLayout(),this},renderElements:function(){var a=this.elements;return a.bar.append(a.switch).append(a.top),a.body.append(a.list),a.wrap.append(a.title).append(a.body).append(a.bar),b(document.body).append(a.wrap).append(a.overlay).attr("id","top"),this},renderLinks:function(){var a=this,c=this.anchors(),d=this.chapters();return b(d).each(function(d,e){var f=b(c[d]),g=e.value,h=b(a.get("LINK")).attr({href:"#"+g,"aria-label":e.text}).addClass(o).addClass(m);f.attr("id",g).addClass(n).append(h)}),this},renderChapters:function(){var a=this,c=this.elements.list,d=this.chapters();return c.empty(),b(d).each(function(d,e){var f=null,g=b(a.get("ITEM")),h=b(a.get("LINK")),i=b(a.get("CHAPTER")),j=b("#toc-list-"+e.pid),k="",l=0;h.attr({id:"toc-link-"+e.id,href:"#"+e.value}).html(e.text),g.attr({id:"toc-item-"+e.id,title:e.text}).append(h),e.pid===-1?(c.append(g),l=g.index()+1,k=l):(f=b("#toc-item-"+e.pid),j[0]||(j=b(w).attr("id","toc-list-"+e.pid),f.append(j)),j.append(g),l=g.index()+1,k=f.find(".toc-chapter").html()+"."+l),i.attr("data-chapter",l).html(k),i.insertBefore(h)}),this},show:function(){var a=this.elements,b=a.wrap;return a.overlay.removeClass(m),b.animate({left:0},150,function(){b.addClass(l)}),this},hide:function(){var a=this.elements,b=a.wrap;return b.animate({left:-300},150,function(){a.overlay.addClass(m),b.removeClass(l)}),this},toggle:function(){return this.elements.wrap.hasClass(l)?this.hide():this.show(),this},updateLayout:function(){var a=this.elements,b=a.wrap[0].offsetHeight,c=a.title[0].offsetHeight;return a.body.height(b-c),this},reload:function(a){return this.setChapters(a).renderChapters(),this},attachEvents:function(){var c=this,d=this.elements,e=d.article,f={context:c};return e.delegate("."+n,"mouseenter",f,this._onAutocJSAnchorMouseEnter),e.delegate("."+n,"mouseleave",f,this._onAutocJSAnchorMouseLeave),d.switch.on("click",f,this._onSwitchClick),d.top.on("click",f,this._onTopClick),d.list.delegate("li","click",f,this._onChapterClick),d.overlay.on("click",f,this._onOverlayClick),b(a).on("resize",f,this._onWindowResize),this},_onAutocJSAnchorMouseEnter:function(a){var c=a.data.context,d=b(this).find("."+o);return d.removeClass(m),c},_onAutocJSAnchorMouseLeave:function(a){var c=a.data.context,d=b(this).find("."+o);return d.addClass(m),c},_onSwitchClick:function(a){var b=a.data.context;return b.toggle(),a.stopPropagation(),a.preventDefault(),b},_onTopClick:function(a){var b=a.data.context;return b.hide(),b},_onChapterClick:function(a){var b=a.data.context;return b.hide(),b},_onOverlayClick:function(a){var b=a.data.context;return b.hide(),a.stopPropagation(),a.preventDefault(),b},_onWindowResize:function(a){var b=a.data.context;return b.updateLayout(),b}},b.extend(b.fn,{autoc:function(a){var b=this,c=E.defaults,d=a&&a.selector?a.selector:c.selector,e=a&&a.prefix?a.prefix:c.prefix,f=a&&a.title?a.title:c.title;return new E({article:b,selector:d,prefix:e,title:f})}}),a.AutocJS=E,a.autoc=function(a){return new E(a)},E});