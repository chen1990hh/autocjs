/* 
 AutocJS - Simple & Fast to create a table of contents menu for your article. 
 Copyright (c) 2016 yaohaixiao, all right reserved. 
 homepage: https://github.com/yaohaixiao/AutocJS/#readme 
 version: 0.1.3 
 author: yaohaixiao  
 license: MIT 
 */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define("autocjs",["jquery"],b(a,$)):"function"==typeof define&&define.cmd?define("autocjs",function(c,d,e){e.exports=b(a,c("jquery"))}):"object"==typeof exports?module.exports=b(a,require("jquery")):b(a,jQuery)}("undefined"!=typeof window?window:this,function(a,b){"use strict";var c="toc-show",d="toc-hide",e="autocjs-anchor",f="toc-icon",g='<div id="toc" class="toc toc-hide" aria-hidden="true"></div>',h='<h3 class="toc-title" id="toc-title" aria-hidden="true">Table of Contents</h3>',j='<div class="toc-bar" aria-hidden="true"></div>',k='<h2 class="toc-switch" class="toc-switch" title="Toggle Menu" aria-hidden="true">&#926;</h2>',l='<a class="toc-top" id="toc-top" href="#top" aria-hidden="true">TOP</a>',m='<nav id="toc-bd" class="toc-bd" aria-hidden="true"></nav>',n='<ol id="toc-list" class="toc-list" aria-hidden="true"></ol>',o='<ol class="toc-sub-list" aria-hidden="true"></ol>',p='<li class="toc-item" aria-hidden="true"></li>',q='<a aria-hidden="true"></a>',r='<a aria-hidden="true" class="toc-anchor-link"></a>',s='<em class="toc-chapter" aria-hidden="true"></em>',t='<div id="toc-overlay" class="toc-overlay toc-hide" aria-hidden="true"></div>',u="h1,h2,h3,h4,h5,h6",v="anchor",w=null,x=null,y=null,z=null,A=null,B=null,C=null,D=null,E=null,F=null,G=-1,H=[],I=function(a){return G+=1,a?a+"-"+G:G},J={version:"0.1.3",defaults:{article:"#article",selector:u,prefix:v,Templates:{WRAP:g,TITLE:h,BAR:j,SWITCH:k,TOP:l,BODY:m,LIST:n,SUB_LIST:n,ITEM:p,LINK:q,ANCHOR_LINK:r,CHAPTER:s,OVERLAY:t}},attributes:{},set:function(a){return b.isPlainObject(a)&&b.extend(this.attributes,a),this},init:function(a){return this.set(this.defaults).set(a)._init().render().attachEvents(),this},_init:function(){var a=this.attributes,c=a.Templates;return w=b(a.article),x=w.find(a.selector),y=b(c.WRAP),z=b(c.TITLE),A=b(c.BAR),B=b(c.SWITCH),C=b(c.TOP),D=b(c.BODY),E=b(c.LIST),F=b(c.OVERLAY),this},render:function(){var a=this.getChapters();return A.append(B).append(C),D.append(E),y.append(z).append(D).append(A),b(document.body).append(y).append(F),this.renderAnchorLinks(a),this.renderChapters(a),y.removeClass(d),this.updateLayout(),this},renderAnchorLinks:function(a){var c=this.attributes,g=c.Templates,h=g.ANCHOR_LINK;return b(a).each(function(a,c){var g=b(x[a]),i=c.value,j=b(h).attr({href:"#"+i,"aria-label":c.text}).addClass(f).addClass(d);g.attr("id",i).addClass(e).append(j)}),this},renderChapters:function(a){var c=this.attributes,d=c.Templates,e=d.ITEM,f=d.LINK;return E.empty(),b(a).each(function(a,c){var d=null,g=b(e),h=b(f),i=b(s),j=b("#toc-list-"+c.pid),k="",l=0;h.attr({id:"toc-link-"+c.id,href:"#"+c.value}).html(c.text),g.attr({id:"toc-item-"+c.id,title:c.text}).append(h),-1===c.pid?(E.append(g),l=g.index()+1,k=l):(d=b("#toc-item-"+c.pid),j[0]||(j=b(o).attr("id","toc-list-"+c.pid),d.append(j)),j.append(g),l=g.index()+1,k=d.find(".toc-chapter").html()+"."+l),i.attr("data-chapter",l).html(k),i.insertBefore(h)}),this},show:function(){return F.removeClass(d),y.animate({left:0},150,function(){y.addClass(c)}),this},hide:function(){return y.animate({left:-300},150,function(){F.addClass(d),y.removeClass(c)}),this},toggle:function(){return y.hasClass(c)?this.hide():this.show(),this},updateLayout:function(){var a=y[0].offsetHeight,b=z[0].offsetHeight;return D.height(a-b),this},reload:function(a){return this.setChapters(a).renderChapters(a),this},_getPidByDiffer:function(a){var b=-1;switch(a){case 1:b=H[H[i-1].pid].pid;break;case 2:b=H[H[H[i-1].pid].pid].pid;break;case 3:b=H[H[H[H[i-1].pid].pid].pid].pid;break;case 4:b=H[H[H[H[H[i-1].pid].pid].pid].pid].pid;break;case 5:b=H[H[H[H[H[H[i-1].pid].pid].pid].pid].pid].pid;break;default:b=H[H[i-1].pid].pid}return b},getChapters:function(){var a=1,c=0,d=this.attributes,e=d.prefix;return x.each(function(d,f){var g=I(e),h=b(f),i=h.html(),j=parseInt(h[0].tagName.toUpperCase().replace(/[H]/gi,""),10),k=-1;j>a?(c+=1,k=1===c?-1:d-1):j===a||a>j&&j>c?1===j?(c=1,k=-1):k=H[d-1].pid:c>=j&&(1===j?c=1:c-=a-j,k=1===c?-1:this._getPidByDiffer(a-j)),a=j,H.push({id:d,level:c,text:i,value:g,tag:f.tagName,pid:k})}),H},setChapters:function(a){return H=a,this},getAnchors:function(){return x},getWrap:function(){return y},getTitle:function(){return z},getBar:function(){return A},getSwitchButton:function(){return B},getTopButton:function(){return C},getBody:function(){return D},getList:function(){return E},getOverlay:function(){return F},attachEvents:function(){return w.delegate("."+e,"mouseenter",this._onAutocJSAnchorMouseEnter),w.delegate("."+e,"mouseleave",this._onAutocJSAnchorMouseLeave),B.on("click",this._onSwitchClick),C.on("click",this._onTopClick),E.delegate("li","click",this._onChapterClick),F.on("click",this._onOverlayClick),b(a).on("resize",this._onWindowResize),this},_onAutocJSAnchorMouseEnter:function(){var a=b(this).find("."+f);return a.removeClass(d),J},_onAutocJSAnchorMouseLeave:function(){var a=b(this).find("."+f);return a.addClass(d),J},_onSwitchClick:function(a){return J.toggle(),a.stopPropagation(),a.preventDefault(),J},_onTopClick:function(a){return J.hide(),a.stopPropagation(),a.preventDefault(),J},_onChapterClick:function(){return J.hide(),J},_onOverlayClick:function(a){return J.hide(),a.stopPropagation(),a.preventDefault(),J},_onWindowResize:function(){return J.updateLayout(),J}};return b.extend(b.fn,{autoc:function(a,b){var c=this,d={article:c,selector:a,prefix:b};return J.init(d)}}),a.AutocJS=J,a.autoc=function(a){return J.init(a)},J});