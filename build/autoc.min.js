/* 
 AutocJS - Simple & Fast to create a table of contents menu for your article. 
 Copyright (c) 2016 yaohaixiao, all right reserved. 
 homepage: https://github.com/yaohaixiao/AutocJS/#readme 
 version: 0.1.3 
 author: yaohaixiao  
 license: MIT 
 */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define("autocjs",["jquery"],b(a,$)):"function"==typeof define&&define.cmd?define("autocjs",function(c,d,e){e.exports=b(a,c("jquery"))}):"object"==typeof exports?module.exports=b(a,require("jquery")):b(a,jQuery)}("undefined"!=typeof window?window:this,function(a,b){"use strict";var c="toc-show",d="toc-hide",e="autocjs-anchor",f="toc-icon",g='<div id="toc" class="toc toc-hide" aria-hidden="true"></div>',h='<h3 class="toc-title" id="toc-title" aria-hidden="true">Table of Contents</h3>',i='<div class="toc-bar" aria-hidden="true"></div>',j='<h2 class="toc-switch" class="toc-switch" title="Toggle Menu" aria-hidden="true">&#926;</h2>',k='<a class="toc-top" id="toc-top" href="#top" aria-hidden="true">TOP</a>',l='<nav id="toc-bd" class="toc-bd" aria-hidden="true"></nav>',m='<ol id="toc-list" class="toc-list" aria-hidden="true"></ol>',n='<ol class="toc-sub-list" aria-hidden="true"></ol>',o='<li class="toc-item" aria-hidden="true"></li>',p='<a aria-hidden="true"></a>',q='<a aria-hidden="true" class="toc-anchor-link"></a>',r='<em class="toc-chapter" aria-hidden="true"></em>',s='<div id="toc-overlay" class="toc-overlay toc-hide" aria-hidden="true"></div>',t="h1,h2,h3,h4,h5,h6",u="anchor",v=null,w=null,x=null,y=null,z=null,A=null,B=null,C=null,D=null,E=null,F=-1,G=[],H=function(a){return F+=1,a?a+"-"+F:F},I={version:"0.1.3",defaults:{article:"#article",selector:t,prefix:u,Templates:{WRAP:g,TITLE:h,BAR:i,SWITCH:j,TOP:k,BODY:l,LIST:m,SUB_LIST:m,ITEM:o,LINK:p,ANCHOR_LINK:q,CHAPTER:r,OVERLAY:s}},attributes:{},set:function(a){return b.isPlainObject(a)&&b.extend(this.attributes,a),this},init:function(a){return this.set(this.defaults).set(a)._init().render().attachEvents(),this},_init:function(){var a=this.attributes,c=a.Templates;return v=b(a.article),w=v.find(a.selector),x=b(c.WRAP),y=b(c.TITLE),z=b(c.BAR),A=b(c.SWITCH),B=b(c.TOP),C=b(c.BODY),D=b(c.LIST),E=b(c.OVERLAY),this},render:function(){var a=this.getChapters();return z.append(A).append(B),C.append(D),x.append(y).append(C).append(z),b(document.body).append(x).append(E),this.renderAnchorLinks(a),this.renderChapters(a),x.removeClass(d),this.updateLayout(),this},renderAnchorLinks:function(a){var c=this.attributes,g=c.Templates,h=g.ANCHOR_LINK;return b(a).each(function(a,c){var g=b(w[a]),i=c.value,j=b(h).attr({href:"#"+i,"aria-label":c.text}).addClass(f).addClass(d);g.attr("id",i).addClass(e).append(j)}),this},renderChapters:function(a){var c=this.attributes,d=c.Templates,e=d.ITEM,f=d.LINK;return D.empty(),b(a).each(function(a,c){var d=null,g=b(e),h=b(f),i=b(r),j=b("#toc-list-"+c.pid),k="",l=0;h.attr({id:"toc-link-"+c.id,href:"#"+c.value}).html(c.text),g.attr({id:"toc-item-"+c.id,title:c.text}).append(h),-1===c.pid?(D.append(g),l=g.index()+1,k=l):(d=b("#toc-item-"+c.pid),j[0]||(j=b(n).attr("id","toc-list-"+c.pid),d.append(j)),j.append(g),l=g.index()+1,k=d.find(".toc-chapter").html()+"."+l),i.attr("data-chapter",l).html(k),i.insertBefore(h)}),this},show:function(){return E.removeClass(d),x.animate({left:0},150,function(){x.addClass(c)}),this},hide:function(){return x.animate({left:-300},150,function(){E.addClass(d),x.removeClass(c)}),this},toggle:function(){return x.hasClass(c)?this.hide():this.show(),this},updateLayout:function(){var a=x[0].offsetHeight,b=y[0].offsetHeight;return C.height(a-b),this},reload:function(a){return this.setChapters(a).renderChapters(a),this},getChapters:function(){var a=1,c=0,d=this.attributes,e=d.prefix;return w.each(function(d,f){var g=H(e),h=b(f),i=h.html(),j=parseInt(h[0].tagName.toUpperCase().replace(/[H]/gi,""),10),k=-1;if(j>a)c+=1,k=1===c?-1:d-1;else if(j===a||a>j&&j>c)1===j?(c=1,k=-1):k=G[d-1].pid;else if(c>=j)if(1===j?c=1:c-=a-j,1===c)k=-1;else switch(a-j){case 1:k=G[G[d-1].pid].pid;break;case 2:k=G[G[G[d-1].pid].pid].pid;break;case 3:k=G[G[G[G[d-1].pid].pid].pid].pid;break;case 4:k=G[G[G[G[G[d-1].pid].pid].pid].pid].pid;break;case 5:k=G[G[G[G[G[G[d-1].pid].pid].pid].pid].pid].pid;break;default:k=G[G[d-1].pid].pid}a=j,G.push({id:d,level:c,text:i,value:g,tag:f.tagName,pid:k})}),G},setChapters:function(a){return G=a,this},getAnchors:function(){return w},getWrap:function(){return x},getTitle:function(){return y},getBar:function(){return z},getSwitchButton:function(){return A},getTopButton:function(){return B},getBody:function(){return C},getList:function(){return D},getOverlay:function(){return E},attachEvents:function(){return v.delegate("."+e,"mouseenter",this._onAutocJSAnchorMouseEnter),v.delegate("."+e,"mouseleave",this._onAutocJSAnchorMouseLeave),A.on("click",this._onSwitchClick),B.on("click",this._onTopClick),D.delegate("li","click",this._onChapterClick),E.on("click",this._onOverlayClick),b(a).on("resize",this._onWindowResize),this},_onAutocJSAnchorMouseEnter:function(){var a=b(this).find("."+f);return a.removeClass(d),I},_onAutocJSAnchorMouseLeave:function(){var a=b(this).find("."+f);return a.addClass(d),I},_onSwitchClick:function(a){return I.toggle(),a.stopPropagation(),a.preventDefault(),I},_onTopClick:function(a){return I.hide(),a.stopPropagation(),a.preventDefault(),I},_onChapterClick:function(){return I.hide(),I},_onOverlayClick:function(a){return I.hide(),a.stopPropagation(),a.preventDefault(),I},_onWindowResize:function(){return I.updateLayout(),I}};return b.extend(b.fn,{autoc:function(a,b){var c=this,d={article:c,selector:a,prefix:b};return I.init(d)}}),a.AutocJS=I,a.autoc=function(a){return I.init(a)},I});